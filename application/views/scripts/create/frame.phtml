<?php 

$this->headScript()->captureStart();?>
function checkform() {
return false;
}
function submit() {//<!--
	framedelay=$('#framebox input');
	if (framedelay.length<2) {$('<div title="Error"><?php echo $this->t->_('TWOPICS');?></div>').dialog({ buttons: [
    {
        text: "Ok",
        click: function() { $(this).dialog("close"); }
    }
] });return false;}
	input=$('.form input');
	post={type:"frame"};
	
	framename=$('#framebox h4');
	post.delay=new Array();
	post.name=new Array();
	  
	for(i=0;i<framedelay.length;i++) {
		post.delay.push(framedelay.eq(i).val());
		post.name.push(framename.eq(i).text());
	}//-->
	for(var key in input) {
		name=input.eq(key).attr('name');
		post[name]=input.eq(key).val();
	}
	post.delayTot=$('input[name=delayTot]').attr('checked');
	$.ajax({
		url: '<?php echo $this->url(array('controller'=>'make','action'=>'index'));?>',
		type: 'post',
		data: post,
		success:function(data) {
			$('<div><img src="<?php echo $this->baseUrl('/upload/'.$this->user);?>/prew.gif"></div>').dialog({
				close:function(event,ui){$(this).dialog( "destroy" );}
			});
		}
	});
}
$(function(){
		var btnUpload=$('#upload');
		var status=$('#status');
		new AjaxUpload(btnUpload, {
			action: '<?php echo $this->url(array('controller'=>'uploader','action'=>'index'));?>',
			name: 'uploadfile',
			onSubmit: function(file, ext){
				 if (! (ext && /^(jpg|png|jpeg|gif)$/.test(ext))){ 
                    // extension is not allowed 
					status.text('Only JPG, PNG or GIF files are allowed');
					return false;
				}
				status.text('Uploading...');
			},
			onComplete: function(file, response){
				//On completion clear the status
				status.text('');
				//Add uploaded file to list
				if(response=="true"){
					$('<li></li>').appendTo('#files').html('<h4>'+file+'</h4><img src="<?php echo $this->baseUrl('upload/'.$this->user);?>/thumb'+file+'" alt="'+file+'" /><input name="delay[]" type="number" min="10" value="100" size="4" maxlength="4" style="width:70px;display:none;">').addClass('success');
				} else{
					$('<li></li>').appendTo('#files').text(file+'<div>'+response+'</div>').addClass('error');
					
				}
			}
		});
		$('.files').sortable({connectWith: "ul",items:"li:not(.listtitle)",stop:function(){
			inputs=$('ul#framebox input');
			if ($('input[name=delayTot]').attr('checked')) inputs.hide(); else inputs.show();
			$('ul#files input').hide();
		}});
		$('.files').disableSelection();
	});
<?php $this->headScript()->captureEnd();?>

<div id="upload" ><span>Upload File</span></div><span id="status" ></span>

<ul id="files" class="files" >
	<li class="listtitle"><?php echo $this->t->_('FILE_DISP');?></li>
<?php 

if ($dp = opendir(APPLICATION_PATH.'/../upload/'.$this->user)) 
{
	while($file = readdir($dp)) {
		if (($file!=".")&&($file!="..")&&is_file(APPLICATION_PATH.'/../upload/'.$this->user.'/'.$file)&&!strstr($file, "thumb")&&($file!="prew.gif"))
		echo '
	<li class="success">
		<h4>'.$file.'</h4>
		'.$this->image('/upload/'.$this->user.'/thumb'.$file,$file,$file," "," ").'
		<input name="delay[]" type="number" min="10" value="100" size="4" maxlength="4" style="width:70px;display:none;">
	</li>';
	}
}
else $this->log->debug("errore");
?>
</ul>
<ul class="files" id="framebox">
<li class="listtitle"><?php echo $this->t->_('FILE_ON_WORK');?></li>
</ul>

<div class="form">
	
	<div>x<input name="x" type="number" min="32" value="150" size="4" maxlength="4" style="width:70px;">px</div>
	<div>y<input name="y" type="number" min="32" value="150" size="4" maxlength="4" style="width:70px;">px</div>
	<div><input name="prop" type="checkbox" value="ok"><?php echo $this->t->_('PROP');?></div>
	<div><?php echo $this->t->_('DELAY');?><input checked="true" onclick="inputT=$('input[name=delayT]');inputs=$('ul#framebox input');if (this.checked) {inputT.attr('disabled','');inputs.hide();} else {inputT.attr('disabled','true');inputs.show();}" name="delayTot" type="checkbox" value="true"><input name="delayT" type="number" value="100" min="10" size="5" maxlength="5" style="width:70px;"></div>
	<div><button onclick="submit();"><?php echo $this->t->_('CREATE');?></button></div>
	
</div>